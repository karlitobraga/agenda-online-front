<div class="initial-container">
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <h1 class="app-title">agende<span class="highlight">hora</span></h1>
        </div>
    </div>

    <!-- Warning Banner -->
    <div class="warning-banner" *ngIf="showConfigWarning">
        <div class="warning-content">
            <mat-icon>warning</mat-icon>
            <div class="warning-text">
                <h3>Cadastre seus Serviços</h3>
                <p>O sistema precisa que você cadastre pelo menos um serviço para começar.</p>
            </div>
            <button mat-flat-button color="warn" (click)="goToConfiguration()">Configurar Agora</button>
        </div>
    </div>

    <!-- Booking Link Card -->
    <div class="booking-link-card" *ngIf="!showConfigWarning">
        <div class="link-content">
            <mat-icon>share</mat-icon>
            <div class="link-text">
                <span class="link-label">Seu link de agendamento:</span>
                <span class="link-url">{{ bookingUrl }}</span>
            </div>
            <button mat-stroked-button (click)="copyBookingLink()">
                <mat-icon>content_copy</mat-icon>
                Copiar
            </button>
        </div>
    </div>

    <!-- Title & Action -->
    <div class="section-title">
        <h2>Meus Agendamentos</h2>
        <button mat-stroked-button color="primary" class="btn-new" (click)="openBookingModal()">
            <mat-icon>add</mat-icon> Novo
        </button>
    </div>

    <!-- Filters -->
    <div class="filters">
        <mat-form-field appearance="outline" class="date-picker">
            <mat-label>Selecione uma data</mat-label>
            <input matInput [matDatepicker]="picker" [(ngModel)]="selectedDate" (dateChange)="onDateChange($event)">
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        <button mat-icon-button (click)="loadSchedules()" class="btn-refresh" title="Recarregar Lista">
            <mat-icon>refresh</mat-icon>
        </button>
    </div>

    <!-- Content -->
    <div class="schedule-list">
        <div class="empty-state" *ngIf="schedules.length === 0">
            <mat-icon class="empty-icon">event_busy</mat-icon>
            <p>Nenhum agendamento para este dia.</p>
        </div>

        <div class="schedule-grid" *ngIf="schedules.length > 0">
            <div class="schedule-card" *ngFor="let schedule of schedules; let i = index"
                [class.completed]="schedule.completed" [class.cancelled]="schedule.isCancelled"
                [class.active-service]="i === 0 && !schedule.completed && !schedule.isCancelled">
                <div class="card-time">
                    <span>{{ schedule.date | date:'HH:mm' }}</span>
                </div>

                <div class="card-details">
                    <div class="active-badge" *ngIf="i === 0 && !schedule.completed && !schedule.isCancelled">Próximo
                    </div>
                    <div class="cancelled-badge" *ngIf="schedule.isCancelled">Cancelado</div>
                    <h3>{{ schedule.clientName || 'Cliente sem nome' }}</h3>

                    <!-- List all offerings or pet items if they exist -->
                    <div class="services-list" *ngIf="!schedule.petItems || schedule.petItems.length === 0">
                        <p class="service-name" *ngFor="let offering of schedule.offerings">
                            {{ offering.name }}
                        </p>
                    </div>

                    <div class="pet-items-list" *ngIf="schedule.petItems && schedule.petItems.length > 0">
                        <div class="pet-item-row" *ngFor="let pet of schedule.petItems">
                            <p class="pet-info">
                                <mat-icon>pets</mat-icon>
                                <strong>{{ pet.breed }}</strong>
                                <span *ngIf="pet.quantity > 1" class="pet-quantity"> (x{{ pet.quantity }})</span>
                                <span *ngIf="pet.name" class="pet-name"> - {{ pet.name }}</span>
                            </p>
                            <div class="pet-services">
                                <span *ngFor="let off of pet.offerings; let last = last">
                                    {{ off.name }}{{ !last ? ', ' : '' }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="contact-row" *ngIf="schedule.phoneNumber">
                        <p class="phone-number">
                            <mat-icon>phone</mat-icon> {{ formatPhone(schedule.phoneNumber) }}
                        </p>
                        <button mat-icon-button class="btn-whatsapp" (click)="openWhatsApp(schedule.phoneNumber)"
                            title="Abrir WhatsApp">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
                        </button>
                    </div>

                    <!-- Total duration -->
                    <p class="service-duration">
                        <mat-icon>timer</mat-icon> {{ getScheduleDuration(schedule) }} min
                    </p>

                    <!-- Total price -->
                    <p class="service-price" *ngIf="getSchedulePrice(schedule) > 0">
                        <mat-icon>attach_money</mat-icon> R$ {{ getSchedulePrice(schedule) | number:'1.2-2' }}
                    </p>
                </div>

                <div class="card-actions">
                    <button mat-icon-button color="primary" *ngIf="!schedule.completed && !schedule.isCancelled"
                        (click)="completeSchedule(schedule)" title="Concluir Atendimento">
                        <mat-icon>check_circle_outline</mat-icon>
                    </button>
                    <button mat-icon-button class="completed-icon" *ngIf="schedule.completed" disabled>
                        <mat-icon>check_circle</mat-icon>
                    </button>

                    <button mat-icon-button color="warn" *ngIf="!schedule.isCancelled"
                        (click)="deleteSchedule(schedule)" title="Cancelar Agendamento">
                        <mat-icon>delete_outline</mat-icon>
                    </button>
                    <mat-icon class="cancelled-icon" *ngIf="schedule.isCancelled" title="Cancelado">cancel</mat-icon>
                </div>
            </div>
        </div>
    </div>
</div>