<div class="settings-container">
    <div class="header">
        <button mat-icon-button (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="header-content">
            <mat-icon class="header-icon">bar_chart</mat-icon>
            <h2>Relatório de Faturamento</h2>
            <p class="subtitle">Visualize o faturamento dos atendimentos concluídos.</p>
        </div>
    </div>

    <div class="filters-card">
        <div class="date-filters">
            <mat-form-field appearance="outline">
                <mat-label>Data Inicial</mat-label>
                <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate">
                <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Data Final</mat-label>
                <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate">
                <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>

            <button mat-raised-button color="primary" (click)="loadReport()" [disabled]="loading">
                <mat-icon>search</mat-icon> Buscar
            </button>
        </div>
    </div>

    <div class="loading" *ngIf="loading">
        <mat-spinner diameter="40"></mat-spinner>
        <span>Carregando relatório...</span>
    </div>

    <div class="content" *ngIf="!loading && summary">
        <div class="summary-cards">
            <mat-card class="summary-card">
                <mat-card-content>
                    <mat-icon>event_available</mat-icon>
                    <div class="stat">
                        <span class="value">{{ summary.totalAppointments }}</span>
                        <span class="label">Atendimentos</span>
                    </div>
                </mat-card-content>
            </mat-card>

            <mat-card class="summary-card revenue">
                <mat-card-content>
                    <mat-icon>attach_money</mat-icon>
                    <div class="stat">
                        <span class="value">{{ summary.totalRevenue | currency:'BRL' }}</span>
                        <span class="label">Faturamento</span>
                    </div>
                </mat-card-content>
            </mat-card>

            <mat-card class="summary-card">
                <mat-card-content>
                    <mat-icon>schedule</mat-icon>
                    <div class="stat">
                        <span class="value">{{ summary.totalMinutes }} min</span>
                        <span class="label">Tempo Total</span>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>

        <h3 class="section-title">Detalhamento</h3>

        <div class="report-list" *ngIf="report.length > 0">
            <div class="report-item" *ngFor="let item of report">
                <div class="item-header">
                    <span class="date">{{ item.date | date:'dd/MM/yyyy HH:mm' }}</span>
                    <span class="client">{{ item.clientName }}</span>
                </div>
                <div class="item-services">
                    <span *ngFor="let svc of item.services" class="service-tag">{{ svc.name }}</span>
                </div>
                <div class="item-total">
                    {{ item.totalPrice | currency:'BRL' }}
                </div>
            </div>
        </div>

        <div class="empty-state" *ngIf="report.length === 0">
            <mat-icon>assessment</mat-icon>
            <h3>Nenhum atendimento concluído</h3>
            <p>Não há atendimentos concluídos no período selecionado.</p>
        </div>
    </div>

    <div class="actions">
        <button mat-stroked-button (click)="goBack()">
            <mat-icon>arrow_back</mat-icon> Voltar
        </button>
    </div>
</div>