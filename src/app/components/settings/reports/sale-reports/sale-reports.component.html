<div class="settings-container">
    <div class="header">
        <button mat-icon-button (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="header-content">
            <mat-icon class="header-icon">shopping_bag</mat-icon>
            <h2>Relatório de Vendas</h2>
            <p class="subtitle">Acompanhe a performance de vendas de produtos.</p>
        </div>
    </div>

    <div class="filters-card">
        <div class="date-filters">
            <mat-form-field appearance="outline">
                <mat-label>Data Inicial</mat-label>
                <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate">
                <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Data Final</mat-label>
                <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate">
                <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>

            <button mat-flat-button color="primary" (click)="loadReport()" [disabled]="loading">
                <mat-icon>search</mat-icon> Atualizar
            </button>
        </div>
    </div>

    <div class="loading" *ngIf="loading">
        <mat-spinner diameter="40"></mat-spinner>
        <span>Compilando dados...</span>
    </div>

    <div class="content" *ngIf="!loading && summary">
        <div class="summary-grid">
            <mat-card class="stat-card">
                <div class="icon-circle"><mat-icon>inventory_2</mat-icon></div>
                <div class="stat-info">
                    <span class="value">{{ summary.totalSales }}</span>
                    <span class="label">Total de Vendas</span>
                </div>
            </mat-card>

            <mat-card class="stat-card revenue">
                <div class="icon-circle"><mat-icon>trending_up</mat-icon></div>
                <div class="stat-info">
                    <span class="value">{{ summary.productRevenue | currency:'BRL' }}</span>
                    <span class="label">Receita de Produtos</span>
                </div>
            </mat-card>
        </div>

        <div class="chart-section" *ngIf="report.length > 0">
            <h3>Distribuição de Vendas por Período</h3>
            <div class="visual-bar-chart">
                 <div class="bar-item" *ngFor="let item of report.slice(0, 10)">
                    <div class="bar-label">{{ item.date | date:'dd/MM HH:mm' }}</div>
                    <div class="bar-container">
                        <div class="bar-fill" [style.width.%]="(item.value / summary.productRevenue) * 500"></div>
                    </div>
                    <div class="bar-value">{{ item.value | currency:'BRL' }}</div>
                 </div>
            </div>
        </div>

        <h3 class="section-title">Detalhamento das Vendas</h3>
        <div class="sales-list">
            <div class="sale-item-card" *ngFor="let item of report">
                <div class="item-icon">
                    <mat-icon>shopping_cart</mat-icon>
                </div>
                <div class="item-main">
                    <div class="item-title">{{ item.description }}</div>
                    <div class="item-sub">{{ item.date | date:'dd/MM/yyyy HH:mm' }} • {{ item.clientName }}</div>
                </div>
                <div class="item-amount">
                    {{ item.value | currency:'BRL' }}
                </div>
            </div>
        </div>

        <div class="empty-state" *ngIf="report.length === 0">
            <mat-icon>shopping_cart_checkout</mat-icon>
            <h3>Nenhuma venda no período</h3>
            <p>Os dados das vendas realizadas no PDV aparecerão aqui.</p>
        </div>
    </div>
</div>
