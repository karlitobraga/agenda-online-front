<div class="settings-container">
    <div class="header">
        <button class="btn-back" (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="header-content">
            <mat-icon class="header-icon">event_busy</mat-icon>
            <h2>Dias Especiais e Feriados</h2>
            <p class="subtitle">Configure dias em que você terá horários diferenciados ou estará fechado.</p>
        </div>
    </div>

    <div class="content">
        <button class="btn-add-toggle" (click)="toggleAddForm()" [class.active]="showAddForm">
            <mat-icon>{{ showAddForm ? 'remove_circle' : 'add_circle' }}</mat-icon>
            <span>{{ showAddForm ? 'Cancelar Adição' : 'Adicionar Dia Especial' }}</span>
        </button>

        <!-- Add Special Day Form -->
        <form [formGroup]="specialDayForm" class="settings-card add-form-card" *ngIf="showAddForm">
            <div class="card-header">
                <div class="card-title">
                    <mat-icon>event_available</mat-icon>
                    <h3>Configurar Novo Dia</h3>
                </div>
                <mat-slide-toggle formControlName="isDayOff" color="warn">
                    {{ specialDayForm.get('isDayOff')?.value ? 'Fechado' : 'Aberto' }}
                </mat-slide-toggle>
            </div>

            <div class="card-content">
                <mat-form-field appearance="outline" class="date-field">
                    <mat-label>Data</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="date" [min]="minDate" />
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>

                <ng-container *ngIf="!specialDayForm.get('isDayOff')?.value">
                    <div class="time-inputs">
                        <mat-form-field appearance="outline" class="time-field">
                            <mat-label>Início</mat-label>
                            <input matInput type="time" formControlName="start" />
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="time-field">
                            <mat-label>Fim</mat-label>
                            <input matInput type="time" formControlName="end" />
                        </mat-form-field>
                    </div>
                </ng-container>

                <div class="time-error" *ngIf="specialDayForm.hasError('timeRangeInvalid')">
                    O horário inicial deve ser menor que o final
                </div>

                <button class="btn-save-day" (click)="addSpecialDay()" [disabled]="specialDayForm.invalid">
                    <mat-icon>check</mat-icon> Confirmar
                </button>
            </div>
        </form>

        <!-- List of Special Days -->
        <h3 class="section-title" *ngIf="specialDays.length > 0">Dias Cadastrados</h3>

        <div class="services-list" *ngIf="specialDays.length > 0">
            <div class="service-card" *ngFor="let day of specialDays">
                <div class="service-info">
                    <div class="service-name">{{ day.date | date: 'dd/MM/yyyy' }}</div>
                    <div class="service-details">
                        <span class="detail-item" [class.closed]="day.isDayOff">
                            <mat-icon>{{ day.isDayOff ? 'event_busy' : 'schedule' }}</mat-icon>
                            {{ day.isDayOff ? 'Fechado' : (day.start + ' - ' + day.end) }}
                        </span>
                    </div>
                </div>
                <div class="service-actions">
                    <button class="btn-icon delete" (click)="deleteSpecialDay(day.id)" title="Excluir">
                        <mat-icon>delete</mat-icon>
                    </button>
                </div>
            </div>
        </div>

        <div class="empty-state" *ngIf="specialDays.length === 0">
            <mat-icon>event_available</mat-icon>
            <h3>Nenhum dia especial cadastrado</h3>
            <p>Adicione feriados ou dias com horários diferenciados.</p>
        </div>
    </div>

    <div class="actions">
        <button mat-stroked-button (click)="goBack()">
            <mat-icon>arrow_back</mat-icon> Voltar
        </button>
    </div>
</div>